Whole CNV Detection contains scripts to call whole-amplicon copy number changes from Illumina sequencing data.


calculate_amp_depths.py: Takes bedgraph coverage file(s) and returns a file of normalized depths of chrY amplicons and control regions.

Coverage files should be GC-corrected first if possible (see GC Correction directory). One or more GC-corrected output bedgraph files are the input of this script. Optional arguments are: 
-o, output filename for the file containing normalized depths of each amplicon and control region (default: ./amplicon_depths)
-g, a file of Y chromosome locations that are not masked by the repeat masking pipeline in the Amplicon Annotation and Repeat Masking directory. By default, this script uses the "good_chrY_amplicon_bases_w100_c11.pickle" file in that directory. (If the directory structure of the master directory isn't present, this script will not be able to locate those files, and you will have to input the location of the file using the -g flag.)
-r, a file of Y chromosome amplicon annotations (provided in the Amplicon Annotation and Repeat Masking directory as "Y_repeats.txt"). This script uses that file by default. As with -g, the directory structure must be the same as the default or else the location of this file must be specified directly using the -r flag.

usage: calculate_amp_depths.py [-h] [-o OUTFILE] [-g GOOD_LOCATIONS]
                               [-r REPEATS_FILE]
                               [input_files [input_files ...]]

Takes a bedgraph coverage file and returns a file of depths of chrY amplicons
and control regions

positional arguments:
  input_files           bedGraph file(s) of Y chromosome depth

optional arguments:
  -h, --help            show this help message and exit
  -o OUTFILE, --outfile OUTFILE
                        Output filename
  -g GOOD_LOCATIONS, --good_locations GOOD_LOCATIONS
                        File of unmasked Y chromosome locations (provided in
                        Amplicon Annotation and Repeat Masking
  -r REPEATS_FILE, --repeats_file REPEATS_FILE
                        File of Y chromosome amplicon locations (provided in
                        Amplicon Annotation and Repeat Masking



calculate_amp_medians.py: Takes bedgraph coverage file(s) and returns a file of normalized median depths of chrY amplicons and control regions.

This script's inputs are the same as calculate_amp_depths.py.



depthfiles_to_dataframe.py: Takes individual amplicon depth files and combines then into a pandas dataframe.

Takes one or more depth files (output of calculate_amp_depths.py) and returns a pandas dataframe in pickle format, used as input of further scripts such as call_amplicon_cn.py. Optional inputs are:
	-n, a file of the list of individual IDs for each input file. This file must be a text file with each ID on a new line, in the same order as the depth files are input when running this script. If this file is not provided, each filename will be used as each individual identifier in the dataframe.
	-g, a file of the halpogroups of some or all of the individuals. This file must be a text file with each line consisting of the individual ID and that individual's haplogroup, separated by a tab. If no -n file is provided, each line should contain the filename of each individual in place of their ID.
	-o, output filename (default: ./amplicon_depths_dataframe.pickle).

usage: depthfiles_to_dataframe.py [-h] [-o OUTFILE] [-n NAMELIST]
                                  [-g HAPLOGROUPS]
                                  [infiles [infiles ...]]

Takes individual amplicon depth files and combines then into a pandas
dataframe

positional arguments:
  infiles               individual files of normalized amplicon depths

optional arguments:
  -h, --help            show this help message and exit
  -o OUTFILE, --outfile OUTFILE
                        Output filename
  -n NAMELIST, --namelist NAMELIST
                        File of male IDs of each file (default: filename of
                        each file)
  -g HAPLOGROUPS, --haplogroups HAPLOGROUPS
                        file of haplogroups of each individual



call_amplicon_cn.py: Calls amplicon copy number from normalized amplicon depth. Takes a pickle file of a pandas dataframe of amplicon and control region depths (generated by depthfiles_to_dataframe.py) and creates a pandas dataframe of amplicon copy-number calls. The resulting file can then be used as input for predict_azfc_architectures.py in Amplicon Architecture Prediction.

usage: call_amplicon_cn.py [-h] [-o OUTFILE] infile

Calls amplicon copy number from normalized amplicon depth

positional arguments:
  infile                pickled pandas dataframe of amplicon depths

optional arguments:
  -h, --help            show this help message and exit
  -o OUTFILE, --outfile OUTFILE
                        Output filename



amplicon_depths_with_chr2_control.py: Takes a default Y chromosome amplicon depth file normalized by single-copy Y sequence and outputs a amplicon depth file normalized by the depth of chr2 (used to verify Y-specificity of amplicons with data from XX and XY individuals). Takes three inputs: 1. filename of Y chromosome amplicon depth file, 2. bedGraph of chr2 depth from the same individual, and 3. output filename.


